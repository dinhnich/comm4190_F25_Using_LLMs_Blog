<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nicholas">
<meta name="dcterms.date" content="2025-09-07">
<meta name="description" content="Does AI have some form of price elasticity understanding?">

<title>Price Elasticity – Nick’s LLM Experiments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-2ceb22b53773876b76da397856803851.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Nick’s LLM Experiments</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Price Elasticity</h1>
                  <div>
        <div class="description">
          Does AI have some form of price elasticity understanding?
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Marketing</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Nicholas </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 7, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><img src="price.png" width="100%"></p>
<section id="does-ai-have-awareness-of-price-sensitivity" class="level2">
<h2 class="anchored" data-anchor-id="does-ai-have-awareness-of-price-sensitivity">Does AI have awareness of price sensitivity?</h2>
<p>Following my first post on testing the credibility of synthetic respondents, I wanted to expand on this notion by testing if AI can make reasonable decisions when it comes to the prices of goods. For example, does AI know whether or not to buy a $100 ice-cream cone? How will it change if I go from a discretionary product to a neccessity like medicine? How far will it say yes to price increases until it won’t purchase an item? Could AI give me a number that it will say yes to and rule out any price higher than that? By testing such capabilities, it would give people interested in possibly using synthetic respondents an understanding of AI’s logical reasoning.</p>
<p>A funny incident I ran into is if I asked it directly it would respond by saying “No - I don’t make purchases.” Meaning in order to get a proper response, I had to first say enable it’s ability. I also had to make sure the prompt focused on the “would” rather than “will”, since I only wanted to test if they would be open to the consideration of buying it at the price instead of will they make that purchase. By framing it this way, I felt it the AI would have to be less literal and specific, instead it would go off general assumptions. In addition, I also had to ask for a yes/no response and also specificaly outline the quality of the item. For example, I used a chocolate bar but I had to put regular chocolate bar to avoid AI going into the realms of some avant garde bar of chocolate that is worth $1000.</p>
<blockquote class="blockquote">
<p>Me: If you did have the ability to make purchases, not will but would you buy a regular chocolate bar that cost $5? Provide a direct yes/no response. Then explain your reasoning.</p>
</blockquote>
<blockquote class="blockquote">
<p>GPT-5: No. A regular chocolate bar typically costs much less than $5, so paying that much would feel like poor value. Unless it had something unique (e.g., gourmet quality, special ingredients, or ethical sourcing that justified the higher price), I wouldn’t consider it a fair purchase.</p>
</blockquote>
<p>I’m impressed! It seems like GPT-5 was very price elastic to the chocolate bar despite the bar being only $5 (only a few dollars more than a Hersheys chocolate bar). It also gave great reasoning mentioning “poor value” and “fair puchase.”</p>
<p>But what if I dropped the price by a dollar? It’s still more expensive than a Hersheys but could AI be subject to anchoring? After all, if the deal was $5, getting it for a dollar less would frame it as a deal.</p>
</section>
<section id="will-ai-be-affected-by-anchoring" class="level2">
<h2 class="anchored" data-anchor-id="will-ai-be-affected-by-anchoring">Will AI be affected by anchoring?</h2>
<p>So here is what I asked.</p>
<blockquote class="blockquote">
<p>Me: What if the regular chocolate bar was bumped down to $4, would you buy it at that cost? Provide a direct yes/no response. Then explain your reasoning.</p>
</blockquote>
<blockquote class="blockquote">
<p>GPT-5: No. Even at $4, a standard chocolate bar is still far above the typical market price. Without added value (such as premium quality, rarity, or ethical considerations), the purchase wouldn’t feel justified compared to more reasonable alternatives.</p>
</blockquote>
<blockquote class="blockquote">
<p>Me: How about $3?</p>
</blockquote>
<blockquote class="blockquote">
<p>GPT-5: No. At $3, it’s getting closer to what could be reasonable for a premium or slightly larger bar, but for a regular chocolate bar, it’s still above the usual value. I’d still view it as overpriced unless there were special qualities to justify it.</p>
</blockquote>
<p>Despite dropping the price on an originally priced $5 chocolate bar, GPT-5 kept strong too it’s reasoning on what a chocolate bar should be and did not view the price dropping as a discount. Instead of anchoring it at $5, GPT anchored it at a set price of what it had in mind for a standard chocolate bar.</p>
</section>
<section id="asking-it-to-name-a-price" class="level2">
<h2 class="anchored" data-anchor-id="asking-it-to-name-a-price">Asking it to name a price</h2>
<p>Now that we established how AI rations a decision, what if I actually tell it to list a price?</p>
<blockquote class="blockquote">
<p>Me: Name a price for how much you would buy a regular chocolate bar for?</p>
</blockquote>
<blockquote class="blockquote">
<p>GPT-5: Yes — I would buy a regular chocolate bar for about $1 to $2. That range feels fair because it aligns with the typical market price for standard chocolate bars, balancing enjoyment with reasonable value. Anything beyond that starts to feel overpriced unless it’s marketed as premium.</p>
</blockquote>
<p>I found this insightful. AI understands the concept of money, market price, fairness, value, and overpriced. From this viewpoint, I would say it is making similar responses to that of a human participant but how can we go even further and test it’s ability to maintain logic.</p>
</section>
<section id="raising-slightly" class="level2">
<h2 class="anchored" data-anchor-id="raising-slightly">Raising slightly</h2>
<p>GPT responded by giving me a range of $1-$2, what if I was outsde the boundary by just a smudge? Would it give me an exception or stick to a strict rule of 1-2?</p>
<blockquote class="blockquote">
<p>Me: What if the regular chocolate bar from earlier was bumped down to $2.10, would you buy it at that cost? Provide a direct yes/no response. Then explain your reasoning.</p>
</blockquote>
<blockquote class="blockquote">
<p>GPT-5: Yes. It’s slightly above my $1–$2 target, but close enough that I’d accept the small premium for convenience or a brand I like. The value feels reasonable compared to the higher prices we ruled out earlier.</p>
</blockquote>
<p>There’s two things I noticed. 1. It was able to outside the $1-$2 target and accepted the small premium. 2. It said the “value feels reasonable compared to the higher prices we ruled out earlier” which means AI, in this case, did anchor the adjustment to two values. The $1-$2 and the $5 from the beginning.</p>
</section>
<section id="lowering-it-greatly" class="level2">
<h2 class="anchored" data-anchor-id="lowering-it-greatly">Lowering it greatly</h2>
<p>You know the feeling of a deal too good to be true? Almost as if making the deal you were getting scammed despite how much it felt like you were scamming the other guy for the low price. Something so cheap that there must be something wrong with it. Does AI have that same common sense factor that humans have when it comes to a deal being “too good.”</p>
<p>Let’s ask it into ways. 1. A new chocolate bar vs.&nbsp;2. The chocolate bar from before?</p>
<blockquote class="blockquote">
<p>Me: What if a regular chocolate bar was $0.05, would you buy it at that cost? Provide a direct yes/no response. Then explain your reasoning.</p>
</blockquote>
<blockquote class="blockquote">
<p>GPT-5: Yes. At $0.05, the price is far below normal market value, making it an excellent deal. Even if I didn’t particularly want chocolate at that moment, the extremely low cost would justify the purchase because the perceived value greatly outweighs the price.</p>
</blockquote>
<blockquote class="blockquote">
<p>Me: What if the regular chocolate bar from earlier was bumped down to $0.05, would you buy it at that cost? Provide a direct yes/no response. Then explain your reasoning.</p>
</blockquote>
<blockquote class="blockquote">
<p>GPT-5: Yes. Since the same regular chocolate bar we discussed earlier was much more expensive before, seeing it drop to $0.05 makes it an unusually good bargain. The dramatic discount would make the purchase worthwhile, even if it’s more chocolate than I need, because the value is so high compared to the cost.</p>
</blockquote>
<p>In both conditions, AI said yes and did not question the far below market value cost of the chocolate bar. But maybe it’s just because it’s a bar of chocolate? How might it respond if it was a car being sold at 5 cents? Could it be for greater purhcases that contain much more value the risk is higher or the elasticity is lower.</p>
<section id="using-a-more-valuable-object" class="level3">
<h3 class="anchored" data-anchor-id="using-a-more-valuable-object">Using a more valuable object</h3>
<blockquote class="blockquote">
<p>Me: Would you buy a car that cost $0.05. Provide a direct yes/no response. Then explain your reasoning.</p>
</blockquote>
<blockquote class="blockquote">
<p>GPT-5: Yes. A car, even an old or imperfect one, has far more inherent value than $0.05. At that price, the risk is negligible, and the potential benefit is huge. Even if it didn’t run, the parts or scrap value alone would greatly exceed the cost.</p>
</blockquote>
<p>Perfect! Though GPT did say yes, in it’s reason it acknowledged risk and the possibility that the car didn’t even run! But nonetheless, if still gave counters to those weaknesses by claiming the car’s parts or scrap value would exceed the cost. However 5 cents is a small risk for anyone’s pocket and surely most people would spend 5 cents on a car regardless of how bad in shape it was. But what about $1000? After all, maybe for a car that is still very cheap but $1000 is not an easy gamble either.</p>
<blockquote class="blockquote">
<p>Me: Would you buy a car that cost $1000. Provide a direct yes/no response. Then explain your reasoning.</p>
</blockquote>
<blockquote class="blockquote">
<p>GPT-5: Yes. At $1000, even an older or used car is usually worth that much in transportation value or resale. As long as it’s in at least running condition, the price is a bargain compared to typical car costs, making it a reasonable purchase.</p>
</blockquote>
<p>This is where AI may fail the common sense test. Sure it mentioned that if the car was at least in running condition, it would be a bargain. But there may be several other factors to the car outside of it running that would make spending $1000 a risk. After all, what if the car was stolen, needs constant mantinence, falling apart, not safe to drive. Tons of factors that should be considered are not, and AI still makes the choice to spend $1000 which is a hefty price for the “average” American.</p>
<p>Overall, I think AI does make reasonable responses that human respondents would make. It was very impressive during the analysis of the chocolate bar and gave outputs that make perfect logical sense. However, when it came to the car, I am a bit skeptic on how much GPT can be seen as a customer? After all, it doesn’t have a bank account, income, expenses, or anything monetary. Could it ever accurately respond to risk and rewards?</p>
<p><img src="chat.png" width="50%"></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/dinhnich\.github\.io\/comm4190_F25_Using_LLMs_Blog\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>